---
import { getCollection } from "astro:content";
import ArrowIcon from "../components/ArrowIcon.astro";
import WathqnyConfig from "../wathqny.config";

const docs = await getCollection("docs"); 

const { sidebar } = WathqnyConfig;

docs.sort((a, b) => (a.data.position > b.data.position ? 1 : -1));
---

<aside class="wtq-sidebar">
  <div>
    <ul class="wtq-sidebar-category" role="tablist">
      <li role="tab">
        <button class="wtq-sidebar-toggle" aria-label="toggle expand sidebar">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 56 56"
            ><g transform="translate(56 0) scale(-1 1)"
              ><path
                fill="currentColor"
                d="M7.715 49.574h40.57c4.899 0 7.36-2.437 7.36-7.265V13.69c0-4.828-2.461-7.265-7.36-7.265H7.715C2.84 6.426.355 8.84.355 13.69v28.62c0 4.851 2.485 7.265 7.36 7.265m.07-3.773c-2.344 0-3.656-1.242-3.656-3.68V13.88c0-2.438 1.312-3.68 3.656-3.68h26.367v35.602ZM48.215 10.2c2.32 0 3.656 1.242 3.656 3.68v28.24c0 2.438-1.336 3.68-3.656 3.68H37.832V10.199Zm-5.883 8.696h5.016c.726 0 1.336-.633 1.336-1.313c0-.703-.61-1.312-1.336-1.312h-5.016c-.703 0-1.336.609-1.336 1.312c0 .68.633 1.313 1.336 1.313m0 6.07h5.016c.726 0 1.336-.633 1.336-1.336c0-.703-.61-1.29-1.336-1.29h-5.016c-.703 0-1.336.587-1.336 1.29c0 .703.633 1.336 1.336 1.336m0 6.047h5.016c.726 0 1.336-.586 1.336-1.29c0-.702-.61-1.312-1.336-1.312h-5.016c-.703 0-1.336.61-1.336 1.313s.633 1.289 1.336 1.289"
              ></path></g
            ></svg
          >
        </button>
      </li>
      {
        sidebar?.map((category) => {
          let activeClass = "";
          let cutUrl =
            "/" +
            Astro.url.pathname
              .split("/")
              .filter((url) => {
                if (url != "") {
                  return true;
                }
              })
              .reverse()[0];

          docs.map((doc) => {
            if (doc.data.href == cutUrl && doc.data.category == category) {
              activeClass = "wtq-active";
            }
          });
          return (
            <li class={activeClass} role="tab">
              <button
                aria-expanded="false"
                tabindex="0"
                class={`wtq-sidebar-category-link ${activeClass}`}
                id={`${category.toLowerCase()}-category`}>
                {category.replace("-", " ")} <ArrowIcon />
              </button>
              <ul class="wtq-sidebar-category-collapse" aria-labelledby={`${category.toLowerCase()}-category`}>
                {docs.map((doc) => {
                  return (
                    doc.data.category == category && (
                      <li class="wtq-doc-list-item">
                        <a
                          tabindex="-1"
                          class="wtq-doc-link"
                          href={
                            "/docs/" + category.toLowerCase() + doc.data.href + "/"
                          }>
                          {doc.data.title}
                        </a>
                      </li>
                    )
                  );
                })}
              </ul>
            </li>
          );
        })
      }
    </ul>
  </div>
</aside>

<script src="./sidebar.ts"></script>
