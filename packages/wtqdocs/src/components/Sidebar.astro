---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";

import WathqnyConfig from "/wathqny.config";

const docs = await getCollection("docs");

const { category } = WathqnyConfig;

docs.sort(
  (a: { data: { position: number } }, b: { data: { position: number } }) =>
    a.data.position > b.data.position ? 1 : -1
);

let cutUrl =
  "/" +
  Astro.url.pathname
    .split("/")
    .filter((url) => url !== "")
    .reverse()[0];
---

<aside class="wtq-sidebar">
  <ul class="wtq-sidebar-category" role="tablist">
    {
      category?.map((category: string) => {
        let ActiveClass = false;
        docs.map((doc: { data: { href: string; category: any } }) => {
          if (doc.data.href == cutUrl && doc.data.category == category) {
            ActiveClass = true;
          }
        });
        return (
          <li class:list={[{ "wtq-active": ActiveClass }]} role="tab">
            <button
              aria-expanded="false"
              tabindex="0"
              class:list={[
                "wtq-sidebar-category-link wtq-focusable",
                { "wtq-active": ActiveClass },
              ]}
              id={`${category.toLowerCase()}-category`}>
              {category.replace("-", " ")}{" "}
              <Icon class="arrow-icon" name={"arrow"} />
            </button>
            <ul
              aria-labelledby={`${category.toLowerCase()}-category`}
              class:list={[
                "wtq-sidebar-category-collapse ",
                { "wtq-active": ActiveClass },
              ]}
              style={`${ActiveClass && "max-height: 0px;"}`}>
              {docs.map(
                (doc: {
                  data: { category: any; href: string; title: unknown };
                }) => {
                  return (
                    doc.data.category == category && (
                      <li class="wtq-doc-list-item">
                        <a
                          tabindex="-1"
                          class="wtq-doc-link wtq-focusable"
                          href={
                            "/docs/" + category.toLowerCase() + doc.data.href
                          }>
                          {doc.data.title}
                        </a>
                      </li>
                    )
                  );
                }
              )}
            </ul>
          </li>
        );
      })
    }
  </ul>
  <button
    aria-label="expand sidebar toggle"
    class="wtq-collapse-button wtq-focusable"
    ><Icon name={"double-arrow"} /></button
  >
</aside>
<script src="./sidebar.ts"></script>
