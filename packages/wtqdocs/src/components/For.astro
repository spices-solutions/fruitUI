---
interface Props {
  each: string[] | object[] | object;
  self?: boolean;
}

const { each, self } = Astro.props as Props;

let memorySafeCounter = 0;


// let startTime = performance.now();
 


async function forloop(each) {  
  let html = "";
  if (Astro.slots.has("default")) {
    console.log(each.length)
    for (let i = 0; i < each.length; i++) {
      if (self && memorySafeCounter < 5) {
        if (Array.isArray(each[i].items)) {
          console.log(each[i].items)
          memorySafeCounter++;
          html += await forloop(each[i].items);
          console.log(html)
        }
      }
      html += await Astro.slots.render("default", [each[i]]);
    }
  }
  return html;
}

  // let endTime = performance.now();
  // const timeDiff = endTime - startTime;
  // const roundedTimeDiff = timeDiff.toFixed(7); // Round to 7 decimal places
  // console.log(`Execution time: ${roundedTimeDiff}ms`);
---

<Fragment set:html={forloop(each)} />