---
import { getCollection } from "astro:content";
import Category from "./Category.astro";
import CollapseButton from "./CollapseButton.astro";
import type { WathqnyConfig as WathqnyConfigType } from "wtqtypes";

// @ts-ignore
import untypedWathqnyConfig from "/wathqny.config";
import For from "./For.astro";
import LinkItem from "./LinkItem.astro";

const WathqnyConfig: WathqnyConfigType = untypedWathqnyConfig;

const docs = await getCollection("docs");

const { sidebar } = WathqnyConfig;

docs.sort(
  (a: { data: { position: number } }, b: { data: { position: number } }) =>
    a.data.position > b.data.position ? 1 : -1
);

let currentUrl =
  "/" +
  Astro.url.pathname
    .split("/")
    .filter((url) => url !== "")
    .reverse()[0];

let ActiveClass: boolean = true;
---

<aside class="wtq-sidebar">
  <ul class="sidebar_category" role="tablist">
    <For each={sidebar} self="items">
      {
        (item: string) => (
          <Category name={item.name}>
            <For each={docs}>
              {(doc: string) =>
                doc.data.category == item.id && (
                  <LinkItem name={doc.data.title} />
                )
              }
            </For>
          </Category>
        )
      }
    </For>
  </ul>
  <CollapseButton />
</aside>

<script src="./sidebar.ts"></script>
